<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content=""><title>Geospatial Visualization (II) | Statistical Data Visualization</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/r.min.js"></script>
<script>hljs.highlightAll();</script>

  <meta name="keywords" content="">
  <meta name="description" content=""><link rel="stylesheet" href="/stat679_notes/assets/main.css?v=0.3.3" />
<script src="/stat679_notes/assets/main.js?v=0.3.3" defer></script><link rel="stylesheet" href="/stat679_notes/assets/css/tomorrow.css" />
<script src="/stat679_notes/assets/js/highlight.js"></script><script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="https://unpkg.com/mermaid@7.1.0/dist/mermaid.min.js" defer></script></head>
<body class="body-post">
    <a href="/stat679_notes/" class="logo"><h1>Statistical Data Visualization</h1>
</a><main class="post__wrapper"><div class="post__top_navs clearfix">
    <nav class="post__archive_path"><a href="" id="archiveBtn">
        <div class="post__archive_icon">
          <svg width="40" height="40">
            <circle class="circle-progress" r="18" cy="20" cx="20"  stroke-linejoin="round" stroke-linecap="round" />
          </svg>
          <span class="post__archive_icon"></span>
        </div>
        Statistical Data Visualization
      </a>
    </nav>
  </div>
  <article class="post">
    <header class="post__header">
      <h1 class="post__title">Geospatial Visualization (II)</h1>
      <div class="post__meta">
        <time>2022-06-01 00:00</time>
      </div>
    </header>
    <div class="post__content content">
      <p><em>Useful tricks for visualizing geospatial data</em></p>

<p><a href="https://github.com/krisrs1128/stat679_code/blob/main/notes/week7-4.Rmd">Code</a>,
<a href="https://krisrs1128.github.io/stat679_notes/2022/06/01/week7-4.html">Recording</a></p>

<ol>
  <li>
    <p>The previous lecture outlined general methods available for
visualizing spatial and raster datasets. Those methods are used in
almost every spatial data visualization problem. In contrast, these
notes are more like a grab bag of tricks — often useful, but don’t
expect to use them in every problem.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(tigris)
library(tmap)
library(sf)
library(patchwork)
library(biscale)
library(tidyverse)
library(tidycensus)
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="vector-data-packages">Vector data packages</h3>

<ol>
  <li>
    <p>What if we have data with geographic information (e.g., state names)
but which are not explicitly georeferenced? In this case, we may be
able to link the data.frame with a public vector dataset. The
Natural Earth project provides a rich catalog of vector data
searchable by region, and the <code class="language-plaintext highlighter-rouge">rnaturalearth</code> package provides a
direct interface to R.</p>
  </li>
  <li>
    <p>For example, we can find the polygon boundaries for all the counties
in Wisconsin using the code below.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wisconsin &lt;- counties(state = "Wisconsin")

##   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%

tm_shape(wisconsin) +
  tm_polygons()
</code></pre></div>    </div>

    <p><img src="/stat679_notes/assets/week7-4/unnamed-chunk-3-1.png" alt="" /></p>
  </li>
  <li>
    <p>Similarly, we can create a choropleth of household income across all
census extracts in Dane County retrieved in the previous step.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sign up for an api key at http://api.census.gov/data/key_signup.html
dane &lt;- get_acs(
  state = "WI",
  county = "Dane",
  geography = "tract",
  variables = "B19013_001", # household income
  geometry = TRUE
)

##   |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  12%  |                                                                              |===========                                                           |  15%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |=====================                                                 |  29%  |                                                                              |======================                                                |  31%  |                                                                              |=======================                                               |  32%  |                                                                              |========================                                              |  34%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |================================                                      |  45%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |=====================================                                 |  52%  |                                                                              |======================================                                |  54%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |===========================================================           |  84%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%

tm_shape(dane) +
  tm_polygons(col = "estimate", palette = "Purples")
</code></pre></div>    </div>

    <p><img src="/stat679_notes/assets/week7-4/unnamed-chunk-4-1.png" alt="" /></p>
  </li>
</ol>

<h3 id="transforming-projections">Transforming Projections</h3>

<ol>
  <li>
    <p>An important subtlety of geographic data visualization is that all
our maps are in 2D, but earth is 3D. The process of associating
points on the earth with 2D coordinates is called “projection.” All
projections introduce some level of distortion, and there is no
universal, ideal projection.</p>
  </li>
  <li>
    <p>A common source of bugs is to use two different projections for the
same analysis. In this class, we will always use the EPSG:4326
projection, which is what is used in most online maps. But in your
own projects, you should always check that the projections are
consistent across data sources. If you find an inconsistency, it
will be important to “reproject” the data into the same CRS. Both
<code class="language-plaintext highlighter-rouge">sf</code> and <code class="language-plaintext highlighter-rouge">terra</code> have utilities for supporting this.</p>
  </li>
</ol>

<h3 id="bivariate-choropleths">Bivariate Choropleths</h3>

<ol>
  <li>
    <p>Choropleths are useful for encoding one data feature across a
collection of polygons. If we have more than one feature of
interest, there is often little we can do besides create several
choropleths side-by-side, each with its own color scales. An
important special case is when there are exactly two continuous
variables of interest.</p>
  </li>
  <li>
    <p>In this case, we can use something called a bivariate choropleth.
This creates a two-dimensional color palette by blending a pair of
color scales. Polygons are then encoded using this scheme. For
example, in the example below, we can see the correlation structure
between obesity adn diabetes across counties in the US.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>health &lt;- read_csv("../examples/week7/week7-3/cdc-diabetes-obesity.csv", na = "No Data") %&gt;%
  mutate(
    diabetes_cat = cut(diabetes, 3),
    obesity_cat = cut(obesity, 3)
  )
us_counties &lt;- counties() %&gt;%
  mutate(county = str_c(STATEFP, COUNTYFP)) %&gt;%
  filter(!(STATEFP %in% c("15", "02", "60", "66", "69", "72", "78"))) %&gt;%
  left_join(health) %&gt;%
  bi_class(x = diabetes_cat, y = obesity_cat, style = "quantile", dim = 3)

map &lt;- us_counties %&gt;%
  st_simplify(dTolerance = 1000) %&gt;% # speeds up plot by coarsening
  ggplot() +
  geom_sf(aes(fill = bi_class), size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "GrPink", dim = 3) +
  bi_theme()

legend &lt;- bi_legend(pal = "GrPink", dim = 3, xlab = "obesity", ylab = "diabetes")
map + inset_element(legend, 0, 0, .3, .3, align_to = "full")
</code></pre></div>    </div>

    <p><img src="/stat679_notes/assets/week7-4/unnamed-chunk-6-1.png" alt="" /></p>
  </li>
</ol>

<h3 id="spatiotemporal-vis">Spatiotemporal Vis</h3>

<ol>
  <li>What if we have the spatial data measured over time? It is common to
use faceting, with one facet per timepoint. However, this approach
does not scale well when there are many timepoints of interest. Some
have advocated for the use of <a href="https://aviz.fr/~bbach/spacetimecubes/Bach2014spacetimecubes.pdf">time
cubes</a>,
where a 2D map is repeated along a third time axis.</li>
</ol>

<p><img src="https://github.com/krisrs1128/stat679_code/raw/main/examples/week7/week7-3/time_cube.png" width="500" /></p>

<p>In this class though, we will steer away from 3D visualization. Instead,
we will focus on approaches that leverage interactivity, specifically
using animation or linked views. We’ll review some approaches next week.</p>

    </div>
  </article></main><script>hljs.initHighlightingOnLoad();</script><footer class="site-footer">
  © 2022<a href="/stat679_notes/">Statistical Data Visualization</a>. Theme<a href="https://github.com/erlzhang/jekyll-theme-persephone" target="_blank">Persephone</a>
</footer>

  </body>
</html>
